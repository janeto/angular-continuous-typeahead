"use strict";var angularTypeahead=angular.module("angular-typeahead",[]);angularTypeahead.directive("typeahead",function(){return{restrict:"A",scope:{suggestionSource:"=typeahead"},require:"?ngModel",link:function(scope,element,attrs,ngModel){function updateModel(event){if(ngModel){var newPickedValue=$(event.target).val(),modelValue=ngModel.$modelValue,value=modelValue.substring(0,modelValue.lastIndexOf(extractor(modelValue,modelValue.length)))+newPickedValue;$(element).typeahead("val",value),scope.$apply(function(){ngModel.$setViewValue(value)})}}function getCaretPosition(inputElement){var caretPos=0;if(document.selection){inputElement.focus();var sel=document.selection.createRange();sel.moveStart("character",-inputElement.value.length),caretPos=sel.text.length}else(inputElement.selectionStart||"0"==inputElement.selectionStart)&&(caretPos=inputElement.selectionStart);return caretPos}function extractor(query,caretStart){query=query.substring(0,caretStart).substring(query.lastIndexOf(" "));var result=/([\w]+)$/.exec(query);return result&&result[1]?result[1].trim():""}var suggestionEngine;suggestionEngine=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:function(query){return Bloodhound.tokenizers.whitespace(extractor(query,getCaretPosition(element[0])))},local:scope.suggestionSource}),suggestionEngine.initialize(),$(element).typeahead({highlight:!0},{name:"suggestions",displayKey:function(datum){return datum},source:suggestionEngine.ttAdapter()}),$(element).on("typeahead:select",function(event,datum,dataset){updateModel(event)}),$(element).on("typeahead:autocomplete",function(event,datum,dataset){updateModel(event)}),$(element).on("typeahead:cursorchange",function(event,datum,dataset){if(ngModel&&datum){var modelValue=ngModel.$modelValue;$(event.target).val(modelValue.substring(0,modelValue.lastIndexOf(extractor(modelValue,modelValue.length)))+datum)}}),scope.$watchCollection("suggestionSource",function(){suggestionEngine.initialize(!0)}),scope.$on("$destroy",function(){$(element).typeahead("destroy")})}}});